/*!
 * xe-ajax.js v3.0.0
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjax=a())}(this,function(){function p(V){return typeof FormData!=="undefined"&&V instanceof FormData}function t(V){if(/(\w+:)\/{2}((.*?)\/|(.*)$)/.test(V.url)){if(RegExp.$1!==location.protocol||RegExp.$2.split("/")[0]!==location.host){return true}}return false}function F(V){return V&&typeof V==="object"}function o(V){return typeof V==="function"}function C(X,Y,W){for(var V in X){if(X.hasOwnProperty(V)){Y.call(W,X[V],V,X)}}}function N(W,Y,X){var V=[];C(W,function(aa,Z){if(F(aa)){V=V.concat(N(aa,Y+"["+Z+"]",Array.isArray(aa)))}else{V.push(encodeURIComponent(Y+"["+(X?"":Z)+"]")+"="+encodeURIComponent(aa))}});return V}function d(V){var W=[];C(V,function(Y,X){if(Y!==undefined){if(F(Y)){W=W.concat(N(Y,X,Array.isArray(Y)))}else{W.push(encodeURIComponent(X)+"="+encodeURIComponent(Y))}}});return W.join("&").replace(/%20/g,"+")}function T(V){Object.assign(this,{url:"",body:null,params:null,cancelToken:null},V);this.ABORT_RESPONSE=undefined;this.method=String(this.method).toLocaleUpperCase();this.crossOrigin=t(this);if(V&&V.jsonp){this.script=document.createElement("script")}else{this.xhr=V.getXMLHttpRequest(this)}S(this)}Object.assign(T.prototype,{abort:function(V){this.xhr.abort(V)},setHeader:function(V,W){this.headers[V]=W},getHeader:function(){return this.headers[name]},deleteHeader:function(V){delete this.headers[V]},clearHeader:function(){this.headers={}},getUrl:function(){var V=this.url;var W="";if(V){if(this.params&&!p(this.params)){W=o(this.paramsSerializer)?this.paramsSerializer(this):d(this.params)}if(W){V+=(V.indexOf("?")===-1?"?":"&")+W}if(/\w+:\/{2}.*/.test(V)){return V}return this.baseURL.replace(/\/$/,"")+"/"+V.replace(/^\//,"")}return V},getBody:function(){var V=this;return new Promise(function(Y,X){var W=null;if(V.body&&V.method!=="GET"){try{if(o(V.transformBody)){V.body=V.transformBody(V.body,V)||V.body}if(o(V.stringifyBody)){W=V.stringifyBody(V.body,V)||null}else{if(p(V.body)){W=V.body}else{if(String(V.bodyType).toLocaleUpperCase()==="FROM_DATA"){W=d(V.body)}else{W=JSON.stringify(V.body)}}}}catch(Z){console.error(Z)}}Y(W)})}});function l(V){this.locked=false;this._xhr=V}Object.assign(l.prototype,{_getBody:function(){var V=this;var W=this._xhr;return new Promise(function(Z,Y){var X={responseText:"",response:W};if(W&&W.response!==undefined&&W.status!==undefined){if(W.responseText){X.responseText=W.responseText;X.response=JSON.parse(W.responseText)}else{X.response=W.response;X.responseText=JSON.stringify(W.response)}}else{X.responseText=JSON.stringify(X.response)}if(V.locked){Y(new TypeError("body stream already read"))}else{V.locked=true;Z(X)}})}});function H(W,Y){var V=this;this.body=new l(Y);this.bodyUsed=false;this.url=W.url;this.headers={};this.status=0;this.statusText="";this.ok=false;this.redirected=false;this.json=function(){return this.body._getBody().then(function(Z){V.bodyUsed=true;return Z.response})};this.text=function(){return this.body._getBody().then(function(Z){V.bodyUsed=true;return Z.responseText})};if(Y&&Y.response!==undefined&&Y.status!==undefined){this.status=Y.status;this.redirected=this.status===302;this.ok=W.getPromiseStatus(this);if(this.status===1223||this.status===204){this.statusText="No Content"}else{if(this.status===304){this.statusText="Not Modified"}else{this.statusText=(Y.statusText||this.statusText).trim()}}if(Y.getAllResponseHeaders){var X=Y.getAllResponseHeaders().trim();if(X){X.split("\n").forEach(function(aa){var Z=aa.indexOf(":");this.headers[aa.slice(0,Z).trim()]=aa.slice(Z+1).trim()},this)}}}}var v=[];var A=[];function D(V){return function(W){if(V.indexOf(W)===-1){V.push(W)}}}function G(W,V){var X=Promise.resolve(V);W.forEach(function(Y){X=X.then(function(Z){return new Promise(function(aa){Y(Z,function(){aa(Z)})})}).catch(function(Z){console.error(Z)})});return X}function s(V){return G(v,V)}function q(V){return G(A,V)}var E={request:{use:D(v)},response:{use:D(A)}};E.request.use(function(W,V){if(!p(W.method==="GET"?W.params:W.body)){if(W.method!=="GET"&&String(W.bodyType).toLocaleUpperCase()==="JSON_DATA"){W.setHeader("Content-Type","application/json; charset=utf-8")}else{W.setHeader("Content-Type","application/x-www-form-urlencoded")}}if(W.crossOrigin){W.setHeader("X-Requested-With","XMLHttpRequest")}V()});var h=[];function y(X){for(var W=0,V=h.length;W<V;W++){if(X===h[W][0]){return W}}}function S(W){if(W.cancelToken){var V=y(W.cancelToken);if(V===undefined){h.push([W.cancelToken,[W]])}else{h[V][1].push(W)}}}function n(V){var W=y(V);if(W!==undefined){h[W][1].forEach(function(X){setTimeout(function(){X.abort()})});h.splice(W,1)}}var a=typeof window==="undefined"?this:window;var M={method:"GET",baseURL:location.origin,async:true,credentials:true,bodyType:"JSON_DATA",headers:{Accept:"application/json, text/plain, */*;"},getXMLHttpRequest:function(){return new XMLHttpRequest()
},getPromiseStatus:function(V){return(V.status>=200&&V.status<300)||V.status===304}};function b(V){return new Promise(function(X,W){return(V&&V.jsonp?f:J)(new T(Object.assign({},M,{headers:Object.assign({},M.headers)},V)),X,W)})}function u(V,Y,X,W){q(new H(V,Y)).then(function(Z){X(Z)})}function J(V,X,W){var Y=V.xhr;s(V).then(function(){Y.open(V.method,V.getUrl(),V.async!==false);if(V.timeout&&!isNaN(V.timeout)){Y.timeout=V.timeout}C(V.headers,function(aa,Z){Y.setRequestHeader(Z,aa)});Y.onreadystatechange=function(){if(Y.readyState===4){u(V,Y,X,W)}};if(V.credentials==="include"){V.xhr.withCredentials=true}else{if(V.credentials==="omit"){V.xhr.withCredentials=false}}V.getBody().then(function(Z){Y.send(Z)}).catch(function(){Y.send()})})}var e=0;function f(X,Z,Y){var V=X.script;var W=X.getUrl();if(!X.jsonpCallback){X.jsonpCallback="_xeajax_jsonp"+(++e)}a[X.jsonpCallback]=function(aa){i(X,{status:200,response:aa},Z,Y)};V.type="text/javascript";V.src=W+(W.indexOf("?")===-1?"?":"&")+X.jsonp+"="+X.jsonpCallback;V.onerror=function(aa){i(X,{status:500,response:null},Z,Y)};if(o(X.sendJSONP)){X.sendJSONP(V,X,Z,Y)}else{document.body.appendChild(V)}}function i(W,Z,Y,X){var V=new H(W,Z);delete a[W.jsonpCallback];if(o(W.sendEndJSONP)){W.sendEndJSONP(W.script,W)}else{document.body.removeChild(W.script)}V.json().then(function(aa){(V.ok?Y:X)(aa)}).catch(function(aa){X(aa)})}var g=function g(V){Object.assign(M,V)};function U(X,W,V){return b(Object.assign({method:X},W,V))}function R(V){return function(){return V.apply(this,arguments).then(function(W){return new Promise(function(Y,X){W.json().then(function(Z){(W.ok?Y:X)(Z)}).catch(function(Z){X(Z)})})})}}var B=b;function m(V){return Promise.all(V.map(function(W){if(W instanceof Promise){return W}else{if(W&&F(W)){return B(W)}}return W}))}function K(V,X,W){return U("GET",F(V)?{}:{url:V,params:X},W)}function w(W,V,X){return U("POST",F(W)?{}:{url:W,body:V},X)}function x(W,V,X){return U("PUT",F(W)?{}:{url:W,body:V},X)}function z(W,V,X){return U("PATCH",F(W)?{}:{url:W,body:V},X)}function j(W,V,X){return U("DELETE",F(W)?{}:{url:W,body:V},X)}function k(V,X,W){return U("GET",{url:V,params:X,jsonp:"callback"},W)}var I=R(K);var L=R(w);var c=R(x);var r=R(z);var P=R(j);function Q(V){return Object.assign(b,V)}function O(V){V.install(b)}Q({doAll:m,doGet:K,getJSON:I,doPost:w,postJSON:L,doPut:x,putJSON:c,doPatch:z,patchJSON:r,doDelete:j,deleteJSON:P,jsonp:k,cancelXHR:n,setup:g,interceptors:E});b.use=O;b.mixin=Q;return b}));