/*!
 * xe-ajax.js v2.6.0
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjax=a())}(this,function(){var w=Array.isArray||function(X){return Object.prototype.toString.call(X)==="[object Array]"};function o(X){return typeof FormData!=="undefined"&&X instanceof FormData}function s(X){if(/(\w+:)\/{2}((.*?)\/|(.*)$)/.test(X.url)){if(RegExp.$1!==location.protocol||RegExp.$2.split("/")[0]!==location.host){return true}}return false}function C(X){return X&&typeof X==="object"}function j(X){return typeof X==="string"}function n(X){return typeof X==="function"}function r(X){return typeof X==="undefined"}function B(Z,aa,Y){for(var X in Z){if(Z.hasOwnProperty(X)){aa.call(Y,Z[X],X,Z)}}}function K(Y,aa,Z){var X=[];B(Y,function(ac,ab){if(C(ac)){X=X.concat(K(ac,aa+"["+ab+"]",w(ac)))}else{X.push(encodeURIComponent(aa+"["+(Z?"":ab)+"]")+"="+encodeURIComponent(ac))}});return X}function c(X){var Y=[];B(X,function(aa,Z){if(aa!==undefined){if(C(aa)){Y=Y.concat(K(aa,Z,w(aa)))}else{Y.push(encodeURIComponent(Z)+"="+encodeURIComponent(aa))}}});return Y.join("&").replace(/%20/g,"+")}function T(X){Object.assign(this,{body:null,params:null},X);this.ABORT_RESPONSE=undefined;this.AFTER_SEND_CALLS=[];this.OPTIONS=X;this.method=String(this.method).toLocaleUpperCase();this.crossOrigin=s(this);if(X&&X.jsonp){this.script=document.createElement("script")}else{this.xhr=X.getXMLHttpRequest(this)}p(this)}Object.assign(T.prototype,{abort:function(X){this.xhr.abort(X)},setHeader:function(X,Y){this.headers[X]=Y},getHeader:function(){return this.headers[name]},deleteHeader:function(X){delete this.headers[X]},clearHeader:function(){this.headers={}},getUrl:function(){var X=this.url;var Y="";if(X){if(this.params&&!o(this.params)){Y=n(this.paramsSerializer)?this.paramsSerializer(this):c(this.params)}if(Y){X+=(X.indexOf("?")===-1?"?":"&")+Y}if(/\w+:\/{2}.*/.test(X)){return X}return this.baseURL.replace(/\/$/,"")+"/"+X.replace(/^\//,"")}return X},getBody:function(){var X=this;return new Promise(function(aa,Z){var Y=null;if(X.body&&X.method!=="GET"){try{if(n(X.transformBody)){X.body=X.transformBody(X.body,X)||X.body}if(n(X.stringifyBody)){Y=X.stringifyBody(X.body,X)||null}else{if(o(X.body)){Y=X.body}else{if(String(X.bodyType).toLocaleUpperCase()==="FROM_DATA"){Y=c(X.body)}else{Y=JSON.stringify(X.body)}}}}catch(ab){console.error(ab)}}aa(Y)})}});function E(X,aa){this.request=X;this.url=X.url;this.headers={};this.status=0;this.statusText="";this.bodyText="";if(aa&&aa.response!==undefined&&aa.status!==undefined){this.status=aa.status||this.status;this.body=aa.response;this.bodyText=aa.responseText||"";if(this.status===1223||this.status===204){this.statusText="No Content"}else{if(this.status===304){this.statusText="Not Modified"}else{this.statusText=(aa.statusText||this.statusText).trim()}}if(aa.getAllResponseHeaders){var Z=aa.getAllResponseHeaders().trim();if(Z){Z.split("\n").forEach(function(ac){var ab=ac.indexOf(":");this.headers[ac.slice(0,ab).trim()]=ac.slice(ab+1).trim()},this)}}else{if(aa.headers){Object.assign(this.headers,aa.headers)}}}else{if(aa){this.body=aa}}try{if(this.body&&!this.bodyText){this.bodyText=JSON.stringify(this.body)}}catch(Y){}if(this.body&&j(this.body)){try{this.body=JSON.parse(this.body)}catch(Y){this.body=this.bodyText}}}var V=[];var J={method:"GET",baseURL:location.origin,async:true,bodyType:"JSON_DATA",headers:{Accept:"application/json, text/plain, */*;"},getXMLHttpRequest:function(){return new XMLHttpRequest()},getPromiseStatus:function(X){return(X.status>=200&&X.status<300)||X.status===304}};function a(X){return new Promise(function(Z,Y){return(X&&X.jsonp?e:H)(new T(Object.assign({},J,{headers:Object.assign({},J.headers)},X)),Z,Y)})}function i(Z,X){var Y=Promise.resolve(X);Z.AFTER_SEND_CALLS.forEach(function(aa){Y=Y.then(function(ab){return aa(ab)||ab}).catch(function(ab){console.error(ab)})});return Y}function t(Y,X,aa,Z){i(Y,X).then(function(ab){(Y.OPTIONS.getPromiseStatus(ab)?aa:Z)(ab)})}function S(X){var Y=Promise.resolve();V.concat(X.interceptor?[X.interceptor]:[]).forEach(function(Z){Y=Y.then(function(aa){if(aa){return aa}else{return new Promise(function(ab){Z(X,function(ac){if(r(ac)){ab()}else{if(n(ac)){X.AFTER_SEND_CALLS.push(ac);ab()}else{ab(new E(X,ac))}}})})}}).catch(function(aa){console.error(aa)})});return Y}function H(X,Z,Y){var aa=X.xhr;S(X).then(function(ab){if(ab&&ab.constructor===E){return t(X,ab,Z,Y)}aa.open(X.method,X.getUrl(),X.async!==false);if(X.timeout){aa.timeout=X.timeout}B(X.headers,function(ad,ac){aa.setRequestHeader(ac,ad)});aa.onreadystatechange=function(){if(aa.readyState===4){t(X,new E(X,aa),Z,Y)}};X.getBody().then(function(ac){aa.send(ac)}).catch(function(){aa.send()})})}var d=0;function e(aa,ac,ab){var Z=aa.OPTIONS;var X=aa.script;var Y=aa.getUrl();if(!aa.jsonpCallback){aa.jsonpCallback="xeajax_jsonp"+(++d)}aa.customCallback=global[aa.jsonpCallback];
global[aa.jsonpCallback]=function(ad){h(aa,{status:200,response:ad},ac,ab)};X.type="text/javascript";X.src=Y+(Y.indexOf("?")===-1?"?":"&")+aa.jsonp+"="+aa.jsonpCallback;X.onerror=function(ad){h(aa,{status:500,response:null},ac,ab)};if(n(Z.sendJSONP)){Z.sendJSONP(X,aa,ac,ab)}else{document.body.appendChild(X)}}function h(Z,ac,ab,aa){var Y=Z.OPTIONS;var X=new E(Z,ac);delete global[Z.jsonpCallback];if(n(Y.sendEndJSONP)){Y.sendEndJSONP(Z.script,Z)}else{document.body.removeChild(Z.script)}if(Z.customCallback){(global[Z.jsonpCallback]=Z.customCallback)(X)}(Z.OPTIONS.getPromiseStatus(ac)?ab:aa)(X)}var f=function f(X){Object.assign(J,X)};var M={use:function(X){if(n(X)){V.push(X)}return M}};M.use(function(Y,X){if(!o(Y.method==="GET"?Y.params:Y.body)){if(Y.method!=="GET"&&String(Y.bodyType).toLocaleUpperCase()==="JSON_DATA"){Y.setHeader("Content-Type","application/json; charset=utf-8")}else{Y.setHeader("Content-Type","application/x-www-form-urlencoded")}}if(Y.crossOrigin){Y.setHeader("X-Requested-With","XMLHttpRequest")}X()});var g=[];var W=0;function R(){this._ID="XEAjax_"+(++W)}function O(X){return function(Z){var Y={status:X,response:Z||""};if(Z&&Z.response!==undefined&&Z.status!==undefined){Y=Z}D.call(this,Y)}}function D(Y){var X=y(this);if(X!==undefined){g[X][1].forEach(function(Z){setTimeout(function(){Z.abort(Y)})});g.splice(X,1)}}Object.assign(R.prototype,{cancel:D,resolve:O(200),reject:O(500)});function y(Z){for(var Y=0,X=g.length;Y<X;Y++){if(Z===g[Y][0]){return Y}}}function p(Z){var Y=Z.cancelable;if(Y&&Y.constructor===R){var X=y(Y);if(X===undefined){g.push([Y,[Z]])}else{g[X][1].push(Z)}}}function U(Z,Y,X){return a(Object.assign({method:Z},Y,X))}function Q(X){return function(){return X.apply(this,arguments).then(function(Y){return Y.body}).catch(function(Y){return Promise.reject(Y.body,this)})}}var A=a;function m(X){return Promise.all(X.map(function(Y){if(Y instanceof Promise){return Y}else{if(Y&&C(Y)){return A(Y)}}return Y}))}function G(X,Z,Y){return U("GET",C(X)?{}:{url:X,params:Z},Y)}function v(Y,X,Z){return U("POST",C(Y)?{}:{url:Y,body:X},Z)}function x(Y,X,Z){return U("PUT",C(Y)?{}:{url:Y,body:X},Z)}function z(Y,X,Z){return U("PATCH",C(Y)?{}:{url:Y,body:X},Z)}function k(Y,X,Z){return U("DELETE",C(Y)?{}:{url:Y,body:X},Z)}function l(X,Z,Y){return U("GET",{url:X,params:Z,jsonp:"callback"},Y)}function u(){return new R()}var F=Q(G);var I=Q(v);var b=Q(x);var q=Q(z);var N=Q(k);function P(X){return Object.assign(a,X)}function L(X){X.install(a)}P({doAll:m,doGet:G,getJSON:F,doPost:v,postJSON:I,doPut:x,putJSON:b,doPatch:z,patchJSON:q,doDelete:k,deleteJSON:N,jsonp:l,cancelable:u,setup:f,interceptor:M});a.use=L;a.mixin=P;return a}));