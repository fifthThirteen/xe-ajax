/**
 * xe-ajax.js v3.2.9
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.XEAjax=e()}(this,function(){"use strict";function t(t){return"undefined"!=typeof FormData&&t instanceof FormData}function e(){return"function"==typeof Blob&&"function"==typeof FormData&&"function"==typeof FileReader}function n(t){return"string"==typeof t}function o(t){return t&&"object"==typeof t}function r(t){return"function"==typeof t}function i(){return location.origin||location.protocol+"//"+location.host}function s(t,e,n){for(var o in t)t.hasOwnProperty(o)&&e.call(n,t[o],o,t)}function u(t,e,n){var r=[];return s(t,function(t,i){o(t)?r=r.concat(u(t,e+"["+i+"]",H(t))):r.push(encodeURIComponent(e+"["+(n?"":i)+"]")+"="+encodeURIComponent(t))}),r}function a(t){var e=[];return s(t,function(t,n){void 0!==t&&(o(t)?e=e.concat(u(t,n,H(t))):e.push(encodeURIComponent(n)+"="+encodeURIComponent(t)))}),e.join("&").replace(/%20/g,"+")}function c(t,e,n){if(t.forEach)t.forEach(e,n);else for(var o=0,r=t.length||0;o<r;o++)e.call(n,t[o],o,t)}function f(t){t.$context=t.$Promise=null}function h(t){return String(t).toLowerCase()}function d(t,e){this.$index=0,this.$list=function(t,e){var n=[];for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];n.push([o,r,[o,r]][e])}return n}(t,e),this.next=function(){return function(t,e){var n=t.$index++>=t.$list.length;return{done:n,value:n?void 0:e}}(this,this.$list[this.$index])}}function l(t){this._map={},t instanceof l?t.forEach(function(t,e){this.set(e,t)},this):s(t,function(t,e){this.set(e,t)},this)}function p(t){for(var e=0,n=k.length;e<n;e++)if(t===k[e][0])return e}function y(){this.onaborted=null,this._abortSignal={aborted:!1}}function m(){this.signal=new B}function b(t){return function(e){-1===t.indexOf(e)&&t.push(e)}}function v(t){var e=t.$Promise||Promise,n=e.resolve(t,t.$context);return c(L.reqQueue,function(o){n=n.then(function(n){return new e(function(t){o(n,function(){t(n)})},t.$context)}).catch(function(t){console.error(t)})}),n}function g(t,e){var n=t.$Promise||Promise,o=n.resolve(e,t.$context);return c(L.respQueue,function(e){o=o.then(function(o){return new n(function(n){e(o,function(e){e&&e.body&&e.status?n($(e,t)):n(o)},t)},t.$context)}).catch(function(t){console.error(t)})}),o}function x(t){N(this,{url:"",body:null,params:null,signal:null},t),this.headers=new D(t.headers),this.method=String(this.method).toLocaleUpperCase(),this.bodyType=String(this.bodyType).toLowerCase(),this.signal&&r(this.signal.install)&&this.signal.install(this)}function w(t,e,n){this._request=n,this._response={body:new function(t,e){this.locked=!1,this._getBody=function(){var n=this,o=e.$Promise||Promise;return this.bodyUsed=!0,new o(function(e,o){n.locked?o(new TypeError("body stream already read")):(n.locked=!0,e(t))},e.$context)}}(t,n),bodyUsed:!1,url:n.url,status:e.status,statusText:e.statusText,redirected:302===e.status,headers:new D(e.headers||{}),type:"basic"},this._response.ok=n.validateStatus(this)}function T(t,e){return new(t.$Promise||Promise)(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}},t.$context)}function $(t,n){if("function"==typeof Response&&t.constructor===Response||t.constructor===w)return t;var o={status:t.status,statusText:t.statusText,headers:t.headers};return e()?new w(t.body instanceof Blob?t.body:new Blob([JSON.stringify(t.body)]),o,n):new w(JSON.stringify(t.body),o,n)}function P(t,e){e(new TypeError("Network request failed"))}function E(t,n,o){var i=r(t.$XMLHttpRequest)?t.$XMLHttpRequest:XMLHttpRequest,s=t.xhr=new i;s._request=t,s.open(t.method,t.getUrl(),!0),t.timeout&&setTimeout(function(){s.abort()},t.timeout),t.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.onload=function(){g(t,new w(s.response,{status:s.status,statusText:function(t){{if(1223===t.status||204===t.status)return"No Content";if(304===t.status)return"Not Modified";if(404===t.status)return"Not Found"}return(t.statusText||t.statusText||"").trim()}(s),headers:function(t){var e={};if(t.getAllResponseHeaders){var n=t.getAllResponseHeaders().trim();n&&c(n.split("\n"),function(t){var n=t.indexOf(":");e[t.slice(0,n).trim()]=t.slice(n+1).trim()})}return e}(s)},t)).then(n)},s.onerror=function(){P(0,o)},s.ontimeout=function(){P(0,o)},e()&&(s.responseType="blob"),"include"===t.credentials?s.withCredentials=!0:"omit"===t.credentials&&(s.withCredentials=!1),t.getBody().catch(function(){return null}).then(function(e){s.send(e),t.$abort&&s.abort()})}function _(t){t.script.parentNode===document.body&&document.body.removeChild(t.script);try{delete X[t.jsonpCallback]}catch(e){X[t.jsonpCallback]=void 0}}function j(t,e){_(t),e(new TypeError("JSONP request failed"))}function O(t,e,n){t.script=document.createElement("script"),v(t).then(function(){var o=t.script;if(t.jsonpCallback||(t.jsonpCallback="jsonp_xeajax_"+Date.now()+"_"+ ++I),r(t.$jsonp))return t.$jsonp(o,t).then(function(n){g(t,$({status:200,body:n},t)).then(e)}).catch(function(t){n(t)});var i=t.getUrl();X[t.jsonpCallback]=function(n){!function(t,e,n){_(t),g(t,$(e,t)).then(n)}(t,{status:200,body:n},e)},o.type="text/javascript",o.src=i+(-1===i.indexOf("?")?"?":"&")+t.jsonp+"="+t.jsonpCallback,o.onerror=function(e){j(t,n)},t.timeout&&setTimeout(function(){j(t,n)},t.timeout),document.body.appendChild(o)})}function S(t){var e=N({},Q,{headers:N({},Q.headers)},t);return new(e.$Promise||Promise)(function(t,n){(e.jsonp?O:function(t,e,n){return v(t).then(function(){return F(t,e,n)})})(new x(e),t,n)},e.$context)}function C(t,e,n){var o=N({method:t,$context:S.$context,$Promise:S.$Promise},e,n);return f(S),o}function R(t){return function(){return S(t.apply(this,arguments))}}function A(t){return function(){var e=t.apply(this,arguments),n=e.$Promise||Promise;return S(e).then(function(t){return new n(function(e,n){t.json().then(function(o){(t.ok?e:n)(o)}).catch(function(t){n(null)})},this)})}}function U(t,e){return function(n,r,i){return C(t,o(n)?n:N({url:n,params:r},e),i)}}function q(t){s(t,function(t,e){S[e]=r(t)?function(){var e=t.apply(S.$context,arguments);return f(S),e}:t})}var H=Array.isArray||function(t){return!!t&&t.constructor===Array},N=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}return t};N(l.prototype,{set:function(t,e){this._map[h(t)]=e},get:function(t){var e=h(t);return this.has(e)?this._map[e]:null},append:function(t,e){var n=h(t);this.has(n)?this._map[n]=this._map[n]+", "+e:this._map[n]=""+e},has:function(t){return this._map.hasOwnProperty(h(t))},keys:function(){return new d(this._map,0)},values:function(){return new d(this._map,1)},entries:function(){return new d(this._map,2)},delete:function(t){delete this._map[h(t)]},forEach:function(t,e){s(this._map,function(n,o,r){t.call(e,n,o,this)},this)}});var D="undefined"==typeof Headers?l:Headers,k=[];Object.defineProperty(y.prototype,"aborted",{get:function(){return this._abortSignal.aborted}}),N(y.prototype,{install:function(t){if(t.signal){var e=p(t.signal);void 0===e?k.push([t.signal,[t]]):k[e][1].push(t)}}}),N(m.prototype,{abort:function(){var t=p(this.signal);void 0!==t&&(c(k[t][1],function(e){e.abort(),k[t][0]._abortSignal.aborted=!0}),k.splice(t,1))}});var B=y,J=m,L={reqQueue:[],respQueue:[]},G={request:{use:b(L.reqQueue)},response:{use:b(L.respQueue)}};G.request.use(function(e,n){e.body&&"GET"!==e.method&&"HEAD"!==e.method&&(t(e.body)||(e.headers.set("Content-Type","application/x-www-form-urlencoded"),"json-data"!==e.bodyType&&"json_data"!==e.bodyType||e.headers.set("Content-Type","application/json; charset=utf-8"))),function(t){return!(!/(\w+:)\/{2}((.*?)\/|(.*)$)/.test(t)||RegExp.$1===location.protocol&&RegExp.$2.split("/")[0]===location.host)}(e.getUrl())&&e.headers.set("X-Requested-With","XMLHttpRequest"),n()}),N(x.prototype,{abort:function(){this.xhr&&this.xhr.abort(),this.$abort=!0},getUrl:function(){var e=this.url,o="";if(e){if(r(this.transformParams)&&(this.params=this.transformParams(this.params||{},this)),this.params&&!t(this.params)){var s=function(t,e){if(t.includes)return t.includes(e);for(var n=0,o=t.length||0;n<o;n++)if(t[n]===e)return!0;return!1}(["no-store","no-cache","reload"],this.cache)?{_t:Date.now()}:{};o=n(this.params)?this.params:(r(this.paramsSerializer)?this.paramsSerializer:a)(N(s,this.params),this)}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),/\w+:\/{2}.*/.test(e)?e:0===e.indexOf("/")?i()+e:this.baseURL.replace(/\/$/,"")+"/"+e}return e},getBody:function(){var e=this;return new(e.$Promise||Promise)(function(o,i){var s=null;if(e.body&&"GET"!==e.method&&"HEAD"!==e.method)try{r(e.transformBody)&&(e.body=e.transformBody(e.body||{},e)||e.body),s=r(e.stringifyBody)?e.stringifyBody(e.body,e)||null:t(e.body)?e.body:n(e.body)?e.body:"form-data"===e.bodyType||"form_data"===e.bodyType?a(e.body):JSON.stringify(e.body)}catch(t){console.error(t)}o(s)},e.$context)}}),c(["body","bodyUsed","url","headers","status","statusText","ok","redirected","type"],function(t){Object.defineProperty(w.prototype,t,{get:function(){return this._response[t]}})}),N(w.prototype,{clone:function(){return new w(this.body,{status:this.status,statusText:this.statusText,headers:this.headers},this._request)},json:function(){return this.text().then(function(t){return JSON.parse(t)})},text:function(){return this.body._getBody()}}),e()&&N(w.prototype,{text:function(){var t=this._request;return this.blob().then(function(e){var n=new FileReader,o=T(t,n);return n.readAsText(e),o})},blob:function(){return this.body._getBody()},arrayBuffer:function(){var t=this._request;return this.blob().then(function(e){var n=new FileReader,o=T(t,n);return n.readAsArrayBuffer(e),o})},formData:function(){return this.text().then(function(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(r))}}),e})}});var F=self.fetch?function(t,e,n){return(t.signal?E:function(t,e,n){var o=r(t.$fetch)?t.$fetch:fetch;t.getBody().then(function(r){var i={_request:t,method:t.method,cache:t.cache,credentials:t.credentials,body:r,headers:t.headers};t.timeout&&setTimeout(function(){P(0,n)},t.timeout),o(t.getUrl(),i).then(function(n){g(t,$(n,t)).then(e)}).catch(function(t){P(0,n)})})}).apply(this,arguments)}:E,I=0,X="undefined"==typeof window?this:window,Q={method:"GET",baseURL:function(){var t=location.pathname,e=function(t,e){if(r(t.lastIndexOf))return t.lastIndexOf(e);for(var n=t.length-1;n>=0;n--)if(e===t[n])return n;return-1}(t,"/")+1;return i()+(e===t.length?t:t.substring(0,e))}(),cache:"default",credentials:"same-origin",bodyType:"json-data",log:!1,headers:{},validateStatus:function(t){return t.status>=200&&t.status<300}},M=S,z={HEAD:U("HEAD"),GET:U("GET"),JSONP:U("GET",{jsonp:"callback"})};c(["POST","PUT","DELETE","PATCH"],function(t){z[t]=function(e,n,r){return C(t,o(e)?e:{url:e,body:n},r)}});var W=J,K=R(z.HEAD),V=R(z.GET),Y=R(z.POST),Z=R(z.PUT),tt=R(z.DELETE),et=R(z.PATCH),nt=R(z.JSONP),ot=A(z.HEAD),rt=A(z.GET),it=A(z.POST),st=A(z.PUT),ut=A(z.DELETE),at=A(z.PATCH),ct=A(z.JSONP),ft={doAll:function(t){var e=S.$Promise||Promise,n=S.$context;return f(S),e.all(t.map(function(t){return o(t)?S(N({$context:n,$Promise:e},t)):t}),n)},ajax:M,fetch:function(t,e){return V(t,null,e)},fetchGet:V,fetchPost:Y,fetchPut:Z,fetchDelete:tt,fetchPatch:et,fetchHead:K,fetchJsonp:nt,getJSON:rt,postJSON:it,putJSON:st,deleteJSON:ut,patchJSON:at,headJSON:ot,jsonp:ct};return N(S,{use:function(t){t.install(S),Q.log&&console.info("["+S.$name+"] Ready. Detected "+t.$name+" v"+t.version)},setup:function(t){N(Q,t)},mixin:q,AbortController:W,serialize:a,interceptors:G,version:"3.2.9",$name:"XEAjax"}),q(ft),S});