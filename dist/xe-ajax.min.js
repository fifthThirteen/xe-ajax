/*!
 * xe-ajax.js v3.0.2
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjax=a())}(this,function(){function r(X){return typeof FormData!=="undefined"&&X instanceof FormData}function v(X){if(/(\w+:)\/{2}((.*?)\/|(.*)$)/.test(X.url)){if(RegExp.$1!==location.protocol||RegExp.$2.split("/")[0]!==location.host){return true}}return false}function J(X){return X&&typeof X==="object"}function q(X){return typeof X==="function"}function G(Z,aa,Y){for(var X in Z){if(Z.hasOwnProperty(X)){aa.call(Y,Z[X],X,Z)}}}function Q(Y,aa,Z){var X=[];G(Y,function(ac,ab){if(J(ac)){X=X.concat(Q(ac,aa+"["+ab+"]",Array.isArray(ac)))}else{X.push(encodeURIComponent(aa+"["+(Z?"":ab)+"]")+"="+encodeURIComponent(ac))}});return X}function e(X){var Y=[];G(X,function(aa,Z){if(aa!==undefined){if(J(aa)){Y=Y.concat(Q(aa,Z,Array.isArray(aa)))}else{Y.push(encodeURIComponent(Z)+"="+encodeURIComponent(aa))}}});return Y.join("&").replace(/%20/g,"+")}var j=[];function B(Z){for(var Y=0,X=j.length;Y<X;Y++){if(Z===j[Y][0]){return Y}}}function A(Y){if(Y.signal){var X=B(Y.signal);if(X===undefined){j.push([Y.signal,[Y]])}else{j[X][1].push(Y)}}}function y(){this.signal={}}Object.assign(y.prototype,{abort:function(){var X=B(this.signal);if(X!==undefined){j[X][1].forEach(function(Y){setTimeout(function(){Y.abort()})});j.splice(X,1)}}});function V(X){Object.assign(this,{url:"",body:null,params:null,signal:null},X);this.ABORT_RESPONSE=undefined;this.method=String(this.method).toLocaleUpperCase();this.crossOrigin=v(this);if(X&&X.jsonp){this.script=document.createElement("script")}else{this.xhr=X.getXMLHttpRequest(this)}A(this)}Object.assign(V.prototype,{abort:function(X){this.xhr.abort(X)},setHeader:function(X,Y){this.headers[X]=Y},getHeader:function(){return this.headers[name]},deleteHeader:function(X){delete this.headers[X]},clearHeader:function(){this.headers={}},getUrl:function(){var X=this.url;var Y="";if(X){if(this.params&&!r(this.params)){Y=q(this.paramsSerializer)?this.paramsSerializer(this):e(this.params)}if(Y){X+=(X.indexOf("?")===-1?"?":"&")+Y}if(/\w+:\/{2}.*/.test(X)){return X}return this.baseURL.replace(/\/$/,"")+"/"+X.replace(/^\//,"")}return X},getBody:function(){var X=this;return new Promise(function(aa,Z){var Y=null;if(X.body&&X.method!=="GET"){try{if(q(X.transformBody)){X.body=X.transformBody(X.body,X)||X.body}if(q(X.stringifyBody)){Y=X.stringifyBody(X.body,X)||null}else{if(r(X.body)){Y=X.body}else{if(String(X.bodyType).toLocaleUpperCase()==="FROM_DATA"){Y=e(X.body)}else{Y=JSON.stringify(X.body)}}}}catch(ab){console.error(ab)}}aa(Y)})}});function m(X){this.locked=false;this._xhr=X}Object.assign(m.prototype,{_getBody:function(){var X=this;var Y=this._xhr;return new Promise(function(ab,aa){var Z={responseText:"",response:Y};if(Y&&Y.response!==undefined&&Y.status!==undefined){if(Y.responseText){Z.responseText=Y.responseText;try{Z.response=JSON.parse(Y.responseText)}catch(ac){Z.response=null}}else{Z.response=Y.response;Z.responseText=JSON.stringify(Y.response)}}else{Z.responseText=JSON.stringify(Z.response)}if(X.locked){aa(new TypeError("body stream already read"))}else{X.locked=true;ab(Z)}})}});function L(Y,aa){var X=this;this.body=new m(aa);this.bodyUsed=false;this.url=Y.url;this.headers={};this.status=0;this.statusText="";this.ok=false;this.redirected=false;this.json=function(){return this.body._getBody().then(function(ab){X.bodyUsed=true;return ab.response})};this.text=function(){return this.body._getBody().then(function(ab){X.bodyUsed=true;return ab.responseText})};if(aa&&aa.response!==undefined&&aa.status!==undefined){this.status=aa.status;this.redirected=this.status===302;this.ok=Y.getPromiseStatus(this);if(this.status===1223||this.status===204){this.statusText="No Content"}else{if(this.status===304){this.statusText="Not Modified"}else{this.statusText=(aa.statusText||this.statusText).trim()}}if(aa.getAllResponseHeaders){var Z=aa.getAllResponseHeaders().trim();if(Z){Z.split("\n").forEach(function(ac){var ab=ac.indexOf(":");this.headers[ac.slice(0,ab).trim()]=ac.slice(ab+1).trim()},this)}}}}var x=[];var D=[];function H(X){return function(Y){if(X.indexOf(Y)===-1){X.push(Y)}}}function K(Y,X){var Z=Promise.resolve(X);Y.forEach(function(aa){Z=Z.then(function(ab){return new Promise(function(ac){aa(ab,function(){ac(ab)})})}).catch(function(ab){console.error(ab)})});return Z}function u(X){return K(x,X)}function s(X){return K(D,X)}var I={request:{use:H(x)},response:{use:H(D)}};I.request.use(function(Y,X){if(!r(Y.method==="GET"?Y.params:Y.body)){if(Y.method!=="GET"&&String(Y.bodyType).toLocaleUpperCase()==="JSON_DATA"){Y.setHeader("Content-Type","application/json; charset=utf-8")}else{Y.setHeader("Content-Type","application/x-www-form-urlencoded")}}if(Y.crossOrigin){Y.setHeader("X-Requested-With","XMLHttpRequest")}X()});var a=typeof window==="undefined"?this:window;var P={method:"GET",baseURL:location.origin,async:true,credentials:true,bodyType:"JSON_DATA",headers:{Accept:"application/json, text/plain, */*;"},getXMLHttpRequest:function(){return new XMLHttpRequest()
},getPromiseStatus:function(X){return(X.status>=200&&X.status<300)||X.status===304}};function b(X){return new Promise(function(Z,Y){return(X&&X.jsonp?h:N)(new V(Object.assign({},P,{headers:Object.assign({},P.headers)},X)),Z,Y)})}function w(X,aa,Z,Y){s(new L(X,aa)).then(function(ab){Z(ab)})}function N(X,Z,Y){var aa=X.xhr;u(X).then(function(){aa.open(X.method,X.getUrl(),X.async!==false);if(X.timeout&&!isNaN(X.timeout)){aa.timeout=X.timeout}G(X.headers,function(ac,ab){aa.setRequestHeader(ab,ac)});aa.onreadystatechange=function(){if(aa.readyState===4){w(X,aa,Z,Y)}};if(X.credentials==="include"){X.xhr.withCredentials=true}else{if(X.credentials==="omit"){X.xhr.withCredentials=false}}X.getBody().then(function(ab){aa.send(ab)}).catch(function(){aa.send()})})}var g=0;function h(Z,ab,aa){var X=Z.script;var Y=Z.getUrl();if(!Z.jsonpCallback){Z.jsonpCallback="_xeajax_jsonp"+(++g)}a[Z.jsonpCallback]=function(ac){k(Z,{status:200,response:ac},ab,aa)};X.type="text/javascript";X.src=Y+(Y.indexOf("?")===-1?"?":"&")+Z.jsonp+"="+Z.jsonpCallback;X.onerror=function(ac){k(Z,{status:500,response:null},ab,aa)};if(q(Z.sendJSONP)){Z.sendJSONP(X,Z,ab,aa)}else{document.body.appendChild(X)}}function k(Y,ab,aa,Z){var X=new L(Y,ab);delete a[Y.jsonpCallback];if(q(Y.sendEndJSONP)){Y.sendEndJSONP(Y.script,Y)}else{document.body.removeChild(Y.script)}X.json().then(function(ac){(X.ok?aa:Z)(ac)}).catch(function(ac){Z(ac)})}var i=function i(X){Object.assign(P,X)};function W(Z,Y,X){return b(Object.assign({method:Z},Y,X))}function U(X){return function(){return X.apply(this,arguments).then(function(Y){return new Promise(function(aa,Z){Y.json().then(function(ab){(Y.ok?aa:Z)(ab)}).catch(function(ab){Z(ab)})})})}}var E=b;function n(X){return Promise.all(X.map(function(Y){if(Y instanceof Promise){return Y}else{if(Y&&J(Y)){return E(Y)}}return Y}))}function p(X,Z,Y){return W("GET",J(X)?{}:{url:X,params:Z},Y)}function z(Y,X,Z){return W("POST",J(Y)?{}:{url:Y,body:X},Z)}function c(Y,X,Z){return W("PUT",J(Y)?{}:{url:Y,body:X},Z)}function o(Y,X,Z){return W("PATCH",J(Y)?{}:{url:Y,body:X},Z)}function f(Y,X,Z){return W("DELETE",J(Y)?{}:{url:Y,body:X},Z)}function l(X,Z,Y){return W("GET",{url:X,params:Z,jsonp:"callback"},Y)}var M=U(p);var O=U(z);var d=U(c);var t=U(o);var S=U(f);var C=y;var F={doAll:n,fetchGet:p,getJSON:M,fetchPost:z,postJSON:O,fetchPut:c,putJSON:d,fetchPatch:o,patchJSON:t,fetchDelete:f,deleteJSON:S,jsonp:l,setup:i,interceptors:I,AjaxController:C};function T(X){return Object.assign(b,X)}function R(X){X.install(b)}T(F);b.use=R;b.mixin=T;return b}));