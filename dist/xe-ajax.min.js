/*!
 * xe-ajax.js v2.5.1
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjax=a())}(this,function(){var w=Array.isArray||function(W){return Object.prototype.toString.call(W)==="[object Array]"};function o(W){return typeof FormData!=="undefined"&&W instanceof FormData}function s(W){if(/(\w+:)\/{2}((.*?)\/|(.*)$)/.test(W.url)){if(RegExp.$1!==location.protocol||RegExp.$2.split("/")[0]!==location.host){return true}}return false}function C(W){return W&&typeof W==="object"}function j(W){return typeof W==="string"}function n(W){return typeof W==="function"}function r(W){return typeof W==="undefined"}function B(Y,Z,X){for(var W in Y){if(Y.hasOwnProperty(W)){Z.call(X,Y[W],W,Y)}}}function K(X,Z,Y){var W=[];B(X,function(ab,aa){if(C(ab)){W=W.concat(K(ab,Z+"["+aa+"]",w(ab)))}else{W.push(encodeURIComponent(Z+"["+(Y?"":aa)+"]")+"="+encodeURIComponent(ab))}});return W}function c(W){var X=[];B(W,function(Z,Y){if(Z!==undefined){if(C(Z)){X=X.concat(K(Z,Y,w(Z)))}else{X.push(encodeURIComponent(Y)+"="+encodeURIComponent(Z))}}});return X.join("&").replace(/%20/g,"+")}function S(W){Object.assign(this,{body:null,params:null},W);this.ABORT_STATUS=false;this.ABORT_RESPONSE=undefined;this.AFTER_SEND_CALLS=[];this.OPTIONS=W;this.method=String(this.method).toLocaleUpperCase();this.crossOrigin=s(this);if(W&&W.jsonp){this.script=document.createElement("script")}else{this.xhr=new XMLHttpRequest()}p(this)}Object.assign(S.prototype,{abort:function(W){if(this.ABORT_STATUS===false){this.ABORT_STATUS=true;this.ABORT_RESPONSE=W;if(n(this.resolveMock)){this.resolveMock()}if(this.xhr.readyState===1){this.xhr.abort()}}},setHeader:function(W,X){this.headers[W]=X},getHeader:function(){return this.headers[name]},deleteHeader:function(W){delete this.headers[W]},clearHeader:function(){this.headers={}},getUrl:function(){var W=this.url;var X="";if(W){if(this.params&&!o(this.params)){X=n(this.paramsSerializer)?this.paramsSerializer(this):c(this.params)}if(X){W+=(W.indexOf("?")===-1?"?":"&")+X}if(/\w+:\/{2}.*/.test(W)){return W}return this.baseURL.replace(/\/$/,"")+"/"+W.replace(/^\//,"")}return W},getBody:function(){var W=this;return new Promise(function(Z,Y){var X=null;if(W.body&&W.method!=="GET"){try{if(n(W.transformBody)){W.body=W.transformBody(W.body,W)||W.body}if(n(W.stringifyBody)){X=W.stringifyBody(W.body,W)||null}else{if(o(W.body)){X=W.body}else{if(String(W.bodyType).toLocaleUpperCase()==="FROM_DATA"){X=c(W.body)}else{X=JSON.stringify(W.body)}}}}catch(aa){console.error(aa)}}Z(X)})}});function E(X,aa){this.request=X;this.url=X.url;this.headers={};this.status=0;this.statusText="";this.bodyText="";if(aa&&aa.response!==undefined&&aa.status!==undefined){this.status=aa.status||this.status;if(X.ABORT_STATUS){var W=X.ABORT_RESPONSE;if(W&&W.response!==undefined&&W.status!==undefined){this.body=W.response;this.status=W.status||this.status}else{this.body=W===undefined?aa.response:W}}else{this.body=aa.response;this.bodyText=aa.responseText||""}if(this.status===1223||this.status===204){this.statusText="No Content"}else{if(this.status===304){this.statusText="Not Modified"}else{this.statusText=(aa.statusText||this.statusText).trim()}}if(aa.getAllResponseHeaders){var Z=aa.getAllResponseHeaders().trim();if(Z){Z.split("\n").forEach(function(ac){var ab=ac.indexOf(":");this.headers[ac.slice(0,ab).trim()]=ac.slice(ab+1).trim()},this)}}else{if(aa.headers){Object.assign(this.headers,aa.headers)}}}else{if(aa){this.body=aa}}try{if(this.body&&!this.bodyText){this.bodyText=JSON.stringify(this.body)}}catch(Y){}if(this.body&&j(this.body)){try{this.body=JSON.parse(this.body)}catch(Y){this.body=this.bodyText}}}var U=[];var J={method:"GET",baseURL:location.origin,async:true,bodyType:"JSON_DATA",headers:{Accept:"application/json, text/plain, */*;"}};function a(W){return new Promise(function(Y,X){return(W&&W.jsonp?e:G)(new S(Object.assign({},J,{headers:Object.assign({},J.headers)},W)),Y,X)})}function i(Y,W){var X=Promise.resolve(W);Y.AFTER_SEND_CALLS.forEach(function(Z){X=X.then(function(aa){return Z(aa)||aa}).catch(function(aa){console.error(aa)})});return X}function t(X,W,Z,Y){i(X,W).then(function(aa){if((aa.status>=200&&aa.status<300)||aa.status===304){Z(aa)}else{Y(aa)}})}function R(W){var X=Promise.resolve();U.concat(W.interceptor?[W.interceptor]:[]).forEach(function(Y){X=X.then(function(Z){if(Z){return Z}else{return new Promise(function(aa){Y(W,function(ab){if(r(ab)){aa()}else{if(n(ab)){W.AFTER_SEND_CALLS.push(ab);aa()}else{aa(new E(W,ab))}}})})}}).catch(function(Z){console.error(Z)})});return X}function G(W,Y,X){var Z=W.xhr;R(W).then(function(aa){if(aa&&aa.constructor===E){return t(W,aa,Y,X)}Z.open(W.method,W.getUrl(),W.async!==false);if(W.timeout){Z.timeout=W.timeout}B(W.headers,function(ac,ab){Z.setRequestHeader(ab,ac)});Z.onreadystatechange=function(){if(Z.readyState===4){t(W,new E(W,Z),Y,X)}};W.getBody().then(function(ab){Z.send(ab)}).catch(function(){Z.send()}).then(function(){if(W.ABORT_STATUS!==false){if(Z.readyState===1){Z.abort()}}})})}function e(Y,aa,Z){var W=Y.script;var X=Y.getUrl();Y.customCallback=global[Y.jsonpCallback];global[Y.jsonpCallback]=function(ab){h(Y,new E(Y,{status:200,body:ab}),aa,Z)};W.type="text/javascript";W.src=X+(X.indexOf("?")===-1?"?":"&")+Y.jsonp+"="+Y.jsonpCallback;W.onerror=function(ab){h(Y,new E(Y,{status:500,body:null}),aa,Z)};document.body.appendChild(W)}function h(X,W,Z,Y){delete global[X.jsonpCallback];document.body.removeChild(X.script);if(X.customCallback){(global[X.jsonpCallback]=X.customCallback)(W)}t(X,W,Z,Y)}var f=a.setup=function f(W){Object.assign(J,W)};var L=a.interceptor={use:function(W){if(n(W)){U.push(W)}return L}};L.use(function(X,W){if(!o(X.method==="GET"?X.params:X.body)){if(X.method!=="GET"&&String(X.bodyType).toLocaleUpperCase()==="JSON_DATA"){X.setHeader("Content-Type","application/json; charset=utf-8")}else{X.setHeader("Content-Type","application/x-www-form-urlencoded")}}if(X.crossOrigin){X.setHeader("X-Requested-With","XMLHttpRequest")}W()});var g=[];var V=0;function Q(){this._ID="XEAjax_"+(++V)}function N(W){return function(Y){var X={status:W,response:Y||""};if(Y&&Y.response!==undefined&&Y.status!==undefined){X=Y}D.call(this,X)}}function D(X){var W=y(this);if(W!==undefined){g[W][1].forEach(function(Y){Y.abort(X)});g.splice(W,1)}}Object.assign(Q.prototype,{cancel:D,resolve:N(200),reject:N(500)});function y(Y){for(var X=0,W=g.length;X<W;X++){if(Y===g[X][0]){return X}}}function p(Y){var X=Y.cancelable;if(X&&X.constructor===Q){var W=y(X);if(W===undefined){g.push([X,[Y]])}else{g[W][1].push(Y)}}}function T(Y,X,W){return a(Object.assign({method:Y},X,W))}function P(W){return function(){return W.apply(this,arguments).then(function(X){return X.body}).catch(function(X){return Promise.reject(X.body,this)})}}var A=a;function m(W){return Promise.all(W.map(function(X){if(X instanceof Promise){return X}else{if(X&&C(X)){return A(X)}}return X}))}function H(W,Y,X){return T("GET",C(W)?{}:{url:W,params:Y},X)}function v(X,W,Y){return T("POST",C(X)?{}:{url:X,body:W},Y)}function x(X,W,Y){return T("PUT",C(X)?{}:{url:X,body:W},Y)}function z(X,W,Y){return T("PATCH",C(X)?{}:{url:X,body:W},Y)}function k(X,W,Y){return T("DELETE",C(X)?{}:{url:X,body:W},Y)}var d=0;function l(W,Y,X){return T("GET",{url:W,params:Y,jsonp:"callback",jsonpCallback:"XEAjax_JSONP_"+(++d)},X)}function u(){return new Q()}var F=P(H);var I=P(v);var b=P(x);var q=P(z);var M=P(k);function O(W){return Object.assign(a,W)}O({doAll:m,doGet:H,getJSON:F,doPost:v,postJSON:I,doPut:x,putJSON:b,doPatch:z,patchJSON:q,doDelete:k,deleteJSON:M,jsonp:l,cancelable:u,setup:f,interceptor:L});a.mixin=O;return a}));