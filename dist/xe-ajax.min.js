/*!
 * xe-ajax.js v3.0.0
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.XEAjax=a())}(this,function(){function s(V){return typeof FormData!=="undefined"&&V instanceof FormData}function w(V){if(/(\w+:)\/{2}((.*?)\/|(.*)$)/.test(V.url)){if(RegExp.$1!==location.protocol||RegExp.$2.split("/")[0]!==location.host){return true}}return false}function G(V){return V&&typeof V==="object"}function r(V){return typeof V==="function"}function D(X,Y,W){for(var V in X){if(X.hasOwnProperty(V)){Y.call(W,X[V],V,X)}}}function N(W,Y,X){var V=[];D(W,function(aa,Z){if(G(aa)){V=V.concat(N(aa,Y+"["+Z+"]",Array.isArray(aa)))}else{V.push(encodeURIComponent(Y+"["+(X?"":Z)+"]")+"="+encodeURIComponent(aa))}});return V}function e(V){var W=[];D(V,function(Y,X){if(Y!==undefined){if(G(Y)){W=W.concat(N(Y,X,Array.isArray(Y)))}else{W.push(encodeURIComponent(X)+"="+encodeURIComponent(Y))}}});return W.join("&").replace(/%20/g,"+")}function T(V){Object.assign(this,{url:"",body:null,params:null,cancelToken:null},V);this.ABORT_RESPONSE=undefined;this.method=String(this.method).toLocaleUpperCase();this.crossOrigin=w(this);if(V&&V.jsonp){this.script=document.createElement("script")}else{this.xhr=V.getXMLHttpRequest(this)}S(this)}Object.assign(T.prototype,{abort:function(V){this.xhr.abort(V)},setHeader:function(V,W){this.headers[V]=W},getHeader:function(){return this.headers[name]},deleteHeader:function(V){delete this.headers[V]},clearHeader:function(){this.headers={}},getUrl:function(){var V=this.url;var W="";if(V){if(this.params&&!s(this.params)){W=r(this.paramsSerializer)?this.paramsSerializer(this):e(this.params)}if(W){V+=(V.indexOf("?")===-1?"?":"&")+W}if(/\w+:\/{2}.*/.test(V)){return V}return this.baseURL.replace(/\/$/,"")+"/"+V.replace(/^\//,"")}return V},getBody:function(){var V=this;return new Promise(function(Y,X){var W=null;if(V.body&&V.method!=="GET"){try{if(r(V.transformBody)){V.body=V.transformBody(V.body,V)||V.body}if(r(V.stringifyBody)){W=V.stringifyBody(V.body,V)||null}else{if(s(V.body)){W=V.body}else{if(String(V.bodyType).toLocaleUpperCase()==="FROM_DATA"){W=e(V.body)}else{W=JSON.stringify(V.body)}}}}catch(Z){console.error(Z)}}Y(W)})}});function m(V){this.locked=false;this._xhr=V}Object.assign(m.prototype,{_getBody:function(){var V=this;var W=this._xhr;return new Promise(function(Z,Y){var X={responseText:"",response:W};if(W&&W.response!==undefined&&W.status!==undefined){if(W.responseText){X.responseText=W.responseText;X.response=JSON.parse(W.responseText)}else{X.response=W.response;X.responseText=JSON.stringify(W.response)}}else{X.responseText=JSON.stringify(X.response)}if(V.locked){Y(new TypeError("body stream already read"))}else{V.locked=true;Z(X)}})}});function I(W,Y){var V=this;this.body=new m(Y);this.bodyUsed=false;this.url=W.url;this.headers={};this.status=0;this.statusText="";this.ok=false;this.redirected=false;this.json=function(){return this.body._getBody().then(function(Z){V.bodyUsed=true;return Z.response})};this.text=function(){return this.body._getBody().then(function(Z){V.bodyUsed=true;return Z.responseText})};if(Y&&Y.response!==undefined&&Y.status!==undefined){this.status=Y.status;this.redirected=this.status===302;this.ok=W.getPromiseStatus(this);if(this.status===1223||this.status===204){this.statusText="No Content"}else{if(this.status===304){this.statusText="Not Modified"}else{this.statusText=(Y.statusText||this.statusText).trim()}}if(Y.getAllResponseHeaders){var X=Y.getAllResponseHeaders().trim();if(X){X.split("\n").forEach(function(aa){var Z=aa.indexOf(":");this.headers[aa.slice(0,Z).trim()]=aa.slice(Z+1).trim()},this)}}}}var y=[];var B=[];function E(V){return function(W){if(V.indexOf(W)===-1){V.push(W)}}}function H(W,V){var X=Promise.resolve(V);W.forEach(function(Y){X=X.then(function(Z){return new Promise(function(aa){Y(Z,function(){aa(Z)})})}).catch(function(Z){console.error(Z)})});return X}function v(V){return H(y,V)}function t(V){return H(B,V)}var F={request:{use:E(y)},response:{use:E(B)}};F.request.use(function(W,V){if(!s(W.method==="GET"?W.params:W.body)){if(W.method!=="GET"&&String(W.bodyType).toLocaleUpperCase()==="JSON_DATA"){W.setHeader("Content-Type","application/json; charset=utf-8")}else{W.setHeader("Content-Type","application/x-www-form-urlencoded")}}if(W.crossOrigin){W.setHeader("X-Requested-With","XMLHttpRequest")}V()});var j=[];function A(X){for(var W=0,V=j.length;W<V;W++){if(X===j[W][0]){return W}}}function S(W){if(W.cancelToken){var V=A(W.cancelToken);if(V===undefined){j.push([W.cancelToken,[W]])}else{j[V][1].push(W)}}}function o(V){var W=A(V);if(W!==undefined){j[W][1].forEach(function(X){setTimeout(function(){X.abort()})});j.splice(W,1)}}var a=typeof window==="undefined"?this:window;var M={method:"GET",baseURL:location.origin,async:true,credentials:true,bodyType:"JSON_DATA",headers:{Accept:"application/json, text/plain, */*;"},getXMLHttpRequest:function(){return new XMLHttpRequest()
},getPromiseStatus:function(V){return(V.status>=200&&V.status<300)||V.status===304}};function b(V){return new Promise(function(X,W){return(V&&V.jsonp?h:K)(new T(Object.assign({},M,{headers:Object.assign({},M.headers)},V)),X,W)})}function x(V,Y,X,W){t(new I(V,Y)).then(function(Z){X(Z)})}function K(V,X,W){var Y=V.xhr;v(V).then(function(){Y.open(V.method,V.getUrl(),V.async!==false);if(V.timeout&&!isNaN(V.timeout)){Y.timeout=V.timeout}D(V.headers,function(aa,Z){Y.setRequestHeader(Z,aa)});Y.onreadystatechange=function(){if(Y.readyState===4){x(V,Y,X,W)}};if(V.credentials==="include"){V.xhr.withCredentials=true}else{if(V.credentials==="omit"){V.xhr.withCredentials=false}}V.getBody().then(function(Z){Y.send(Z)}).catch(function(){Y.send()})})}var g=0;function h(X,Z,Y){var V=X.script;var W=X.getUrl();if(!X.jsonpCallback){X.jsonpCallback="_xeajax_jsonp"+(++g)}a[X.jsonpCallback]=function(aa){k(X,{status:200,response:aa},Z,Y)};V.type="text/javascript";V.src=W+(W.indexOf("?")===-1?"?":"&")+X.jsonp+"="+X.jsonpCallback;V.onerror=function(aa){k(X,{status:500,response:null},Z,Y)};if(r(X.sendJSONP)){X.sendJSONP(V,X,Z,Y)}else{document.body.appendChild(V)}}function k(W,Z,Y,X){var V=new I(W,Z);delete a[W.jsonpCallback];if(r(W.sendEndJSONP)){W.sendEndJSONP(W.script,W)}else{document.body.removeChild(W.script)}V.json().then(function(aa){(V.ok?Y:X)(aa)}).catch(function(aa){X(aa)})}var i=function i(V){Object.assign(M,V)};function U(X,W,V){return b(Object.assign({method:X},W,V))}function R(V){return function(){return V.apply(this,arguments).then(function(W){return new Promise(function(Y,X){W.json().then(function(Z){(W.ok?Y:X)(Z)}).catch(function(Z){X(Z)})})})}}var C=b;function n(V){return Promise.all(V.map(function(W){if(W instanceof Promise){return W}else{if(W&&G(W)){return C(W)}}return W}))}function q(V,X,W){return U("GET",G(V)?{}:{url:V,params:X},W)}function z(W,V,X){return U("POST",G(W)?{}:{url:W,body:V},X)}function c(W,V,X){return U("PUT",G(W)?{}:{url:W,body:V},X)}function p(W,V,X){return U("PATCH",G(W)?{}:{url:W,body:V},X)}function f(W,V,X){return U("DELETE",G(W)?{}:{url:W,body:V},X)}function l(V,X,W){return U("GET",{url:V,params:X,jsonp:"callback"},W)}var J=R(q);var L=R(z);var d=R(c);var u=R(p);var P=R(f);function Q(V){return Object.assign(b,V)}function O(V){V.install(b)}Q({doAll:n,fetchGet:q,getJSON:J,fetchPost:z,postJSON:L,fetchPut:c,putJSON:d,fetchPatch:p,patchJSON:u,fetchDelete:f,deleteJSON:P,jsonp:l,cancelXHR:o,setup:i,interceptors:F});b.use=O;b.mixin=Q;return b}));