/**
 * xe-ajax.js v3.2.0
 * (c) 2017-2018 Xu Liangzhan
 * ISC License.
 * @preserve
 */
!function(t,e){"object"==typeof s&&"undefined"!=typeof module?module.s=e():"function"==typeof define&&define.amd?define(e):t.XEAjax=e()}(this,function(){"use strict";function t(t){return"undefined"!=typeof FormData&&t instanceof FormData}function e(t){return t&&"object"==typeof t}function n(t){return"function"==typeof t}function o(){return location.origin||location.protocol+"//"+location.host}function r(t,e,n){for(var o in t)t.hasOwnProperty(o)&&e.call(n,t[o],o,t)}function s(t,n,o){var i=[];return r(t,function(t,r){e(t)?i=i.concat(s(t,n+"["+r+"]",A(t))):i.push(encodeURIComponent(n+"["+(o?"":r)+"]")+"="+encodeURIComponent(t))}),i}function i(t){var n=[];return r(t,function(t,o){void 0!==t&&(e(t)?n=n.concat(s(t,o,A(t))):n.push(encodeURIComponent(o)+"="+encodeURIComponent(t)))}),n.join("&").replace(/%20/g,"+")}function u(t,e,n){if(t.forEach)t.forEach(e,n);else for(var o=0,r=t.length||0;o<r;o++)e.call(n,t[o],o,t)}function a(t){t.$context=t.$Promise=null}function c(t){return String(t).toLowerCase()}function f(t,e){var n=[];for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];n.push([o,r.join(", "),[o,r.join(", ")]][e])}return n}function d(t){this.$index=0,this.$list=t,this.next=function(){return function(t,e){var n=t.$index++>=t.$list.length;return{done:n,value:n?void 0:e}}(this,this.$list[this.$index])}}function h(t){for(var e=0,n=R.length;e<n;e++)if(t===R[e][0])return e}function p(){var t=!1;Object.defineProperty(this,"aborted",{get:function(){return t}})}function l(){this.signal=new p}function y(t){return function(e){-1===t.indexOf(e)&&t.push(e)}}function m(t){var e=t.$Promise||Promise,n=e.resolve(t,t.$context);return u(N.request,function(o){n=n.then(function(n){return new e(function(t){o(n,function(){t(n)})},t.$context)}).catch(function(t){console.error(t)})}),n}function v(t){C(this,{url:"",body:null,params:null,signal:null},t),this.headers=new H(t.headers),this.method=String(this.method).toLocaleUpperCase(),this.bodyType=String(this.bodyType).toLocaleUpperCase(),this.crossOrigin=function(t){return!(!/(\w+:)\/{2}((.*?)\/|(.*)$)/.test(t.url)||RegExp.$1===location.protocol&&RegExp.$2.split("/")[0]===location.host)}(this),this.signal&&n(this.signal.install)&&this.signal.install(this)}function b(t,e,n){t.$complete=!0,function(t,e){var n=t.$Promise||Promise,o=n.resolve(e,t.$context);return u(N.response,function(e){o=o.then(function(o){return new n(function(n){e(o,function(e){e&&e.constructor!==T?n(new T(t,new x(e))):n(o)})},t.$context)}).catch(function(t){console.error(t)})}),o}(t,function(t,e){if(e)if("undefined"==typeof Response){if(e.constructor===T)return e}else if(e.constructor===Response||e.constructor===T)return e;return new T(t,new x(e))}(t,e)).then(function(t){n(t)})}function x(t){try{var e=function(t){return"string"==typeof t}(t.body)?t.body:JSON.stringify(t.body)}catch(t){e=""}this.status=t.status,this.responseHeaders=t.headers,this.response=e,this.responseText=e}function g(t,e){this.locked=!1,this._xhr=t,this._request=e}function T(t,e){var n=this,o={};if(o.body=new g(e,t),o.bodyUsed=!1,o.url=t.url,o.headers=new H,o.status=0,o.statusText="",o.ok=!1,o.redirected=!1,o.type="basic",u(["body","bodyUsed","url","headers","status","statusText","ok","redirected","type"],function(t){Object.defineProperty(n,t,{get:function(){return o[t]}})}),this.json=function(){return this.body._getBody().then(function(t){return o.bodyUsed=!0,t.response})},this.text=function(){return o.body._getBody().then(function(t){return o.bodyUsed=!0,t.responseText})},e&&void 0!==e.response&&void 0!==e.status&&(o.status=e.status,o.redirected=302===o.status,o.ok=t.validateStatus(this),1223===o.status||204===o.status?o.statusText="No Content":304===o.status?o.statusText="Not Modified":404===o.status?o.statusText="Not Found":o.statusText=(e.statusText||o.statusText).trim(),e.getAllResponseHeaders)){var r=e.getAllResponseHeaders().trim();r&&u(r.split("\n"),function(t){var e=t.indexOf(":");o.headers.set(t.slice(0,e).trim(),t.slice(e+1).trim())})}}function $(t,e,n,o){t.script.parentNode===document.body&&document.body.removeChild(t.script),delete D[t.jsonpCallback],b(t,e,n)}function P(t){var e=C({},q,{headers:C({},q.headers)},t);return new(e.$Promise||Promise)(function(t,o){return(e.jsonp?function(t,e,o){t.script=document.createElement("script"),m(t).then(function(){var r=t.script;if(t.jsonpCallback||(t.jsonpCallback="_xeajax_jsonp"+ ++J),n(t.$jsonp))return new Promise(function(e,n){t.$jsonp(r,t,e,n)}).then(function(n){b(t,n,e)}).catch(function(e){b(t,e,o)});var s=t.getUrl();D[t.jsonpCallback]=function(n){$(t,{status:200,body:n},e)},r.type="text/javascript",r.src=s+(-1===s.indexOf("?")?"?":"&")+t.jsonp+"="+t.jsonpCallback,r.onerror=function(n){$(t,{status:500,body:""},e)},r.onabort=function(n){$(t,{status:500,body:""},e)},t.timeout&&setTimeout(function(){r.onabort()},t.timeout),document.body.appendChild(r)})}:function(t,e,o){m(t).then(function(){if(t.signal||"function"!=typeof fetch){var r=n(t.$XMLHttpRequest)?t.$XMLHttpRequest:XMLHttpRequest,s=t.xhr=new r;s._request=t,s.open(t.method,t.getUrl(),!0),t.timeout&&setTimeout(function(){b(t,{status:0,body:""},e)},t.timeout),t.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.onreadystatechange=function(){4===s.readyState&&b(t,new T(t,s),e)},"include"===t.credentials?s.withCredentials=!0:"omit"===t.credentials&&(s.withCredentials=!1),t.getBody().then(function(t){s.send(t)}).catch(function(){s.send()})}else{var i=n(t.$fetch)?t.$fetch:fetch;t.getBody().then(function(n){var r={_request:t,method:t.method,credentials:t.credentials,body:n,headers:t.headers};t.timeout&&setTimeout(function(){b(t,{status:0,body:""},e)},t.timeout),i(t.getUrl(),r).then(function(n){b(t,n,e)}).catch(function(e){b(t,e,o)})})}})})(new v(e),t,o)},e.$context)}function w(t,e,n){var o=C({method:t,$context:P.$context,$Promise:P.$Promise},e,n);return a(P),o}function O(t){return function(){return k(t.apply(this,arguments))}}function E(t){return function(){var e=t.apply(this,arguments),n=e.$Promise||Promise;return k(e).then(function(t){return new n(function(e,n){t.json().then(function(o){(t.ok?e:n)(o)}).catch(function(t){n(t)})},this)})}}function j(t,n){return function(o,r,s){return w(t,e(o)?o:C({url:o,params:r},n),s)}}function S(t){r(t,function(t,e){P[e]=n(t)?function(){var e=t.apply(P.$context,arguments);return a(P),e}:t})}var A=Array.isArray||function(t){return!!t&&t.constructor===Array},C=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}return t},H="function"==typeof Headers?Headers:function(t){var e={};this.set=function(t,n){e[c(t)]=[n]},this.get=function(t){var n=c(t);return this.has(n)?e[n].join(", "):null},this.append=function(t,n){var o=c(t);if(this.has(o))return e[o].push(n);this.set(o,n)},this.has=function(t){return!!e[c(t)]},this.keys=function(){return new d(f(e,0))},this.values=function(){return new d(f(e,1))},this.entries=function(){return new d(f(e,2))},this.delete=function(t){delete e[c(t)]},this.forEach=function(t,n){r(e,function(e,o,r){t.call(n,e.join(", "),o,this)},this)},t instanceof H?t.forEach(function(t,e){this.set(e,t)},this):r(t,function(t,e){this.set(e,t)},this)},R=[];C(p.prototype,{install:function(t){if(t.signal){var e=h(t.signal);void 0===e?R.push([t.signal,[t]]):R[e][1].push(t)}}}),C(l.prototype,{abort:function(){var t=h(this.signal);void 0!==t&&(u(R[t][1],function(t){setTimeout(function(){t.abort()})}),R.splice(t,1))}});var N={request:[],response:[]},U={request:{use:y(N.request)},response:{use:y(N.response)}};U.request.use(function(e,n){e.body&&"GET"!==e.method&&"HEAD"!==e.method&&(e.headers.set("Content-Type","application/x-www-form-urlencoded"),t(e.body)||"JSON_DATA"!==e.bodyType||e.headers.set("Content-Type","application/json; charset=utf-8")),e.crossOrigin&&e.headers.set("X-Requested-With","XMLHttpRequest"),n()}),C(v.prototype,{abort:function(t){this.xhr.abort(t)},getUrl:function(){var e=this.url,r="";return e?(n(this.transformParams)&&(this.params=this.transformParams(this.params||{},this)),this.params&&!t(this.params)&&(r=n(this.paramsSerializer)?this.paramsSerializer(this.params,this):i(this.params)),r&&(e+=(-1===e.indexOf("?")?"?":"&")+r),/\w+:\/{2}.*/.test(e)?e:0===e.indexOf("/")?o()+e:this.baseURL.replace(/\/$/,"")+"/"+e):e},getBody:function(){var e=this;return new(e.$Promise||Promise)(function(o,r){var s=null;if(e.body&&"GET"!==e.method&&"HEAD"!==e.method)try{n(e.transformBody)&&(e.body=e.transformBody(e.body||{},e)||e.body),s=n(e.stringifyBody)?e.stringifyBody(e.body,e)||null:t(e.body)?e.body:"FORM_DATA"===String(e.bodyType).toLocaleUpperCase()?i(e.body):JSON.stringify(e.body)}catch(t){console.error(t)}o(s)},e.$context)}}),C(x.prototype,{getAllResponseHeaders:function(){var t="",e=this.responseHeaders;if(e)for(var n in e)e.hasOwnProperty(n)&&(t+=n+": "+e[n]+"\n");return t}}),C(g.prototype,{_getBody:function(){var t=this,e=this._xhr,n=this._request;return new(n.$Promise||Promise)(function(n,o){var r={responseText:"",response:e};if(e&&void 0!==e.response&&void 0!==e.status)if(e.responseText){r.responseText=e.responseText;try{r.response=JSON.parse(e.responseText)}catch(t){o(new TypeError(t))}}else r.response=e.response,r.responseText=JSON.stringify(e.response);else r.responseText=JSON.stringify(r.response);t.locked?o(new TypeError("body stream already read")):(t.locked=!0,n(r))},n.$context)}});var J=0,D="undefined"==typeof window?this:window,q={method:"GET",baseURL:function(){var t=location.pathname,e=function(t,e){if(n(t.lastIndexOf))return t.lastIndexOf(e);for(var o=t.length-1;o>=0;o--)if(e===t[o])return o;return-1}(t,"/")+1;return o()+(e===t.length?t:t.substring(0,e))}(),credentials:"same-origin",bodyType:"JSON_DATA",log:!1,headers:{Accept:"application/json, text/plain, */*;"},validateStatus:function(t){return t.status>=200&&t.status<300}},k=P,_={HEAD:j("HEAD"),GET:j("GET"),JSONP:j("GET",{jsonp:"callback"})};u(["POST","PUT","DELETE","PATCH"],function(t){_[t]=function(n,o,r){return w(t,e(n)?n:{url:n,body:o},r)}});var L=O(_.HEAD),B=O(_.GET),G=O(_.POST),X=O(_.PUT),I=O(_.DELETE),M=O(_.PATCH),F=O(_.JSONP),z=E(_.HEAD),W=E(_.GET),K=E(_.POST),Q=E(_.PUT),V=E(_.DELETE),Y=E(_.PATCH),Z=E(_.JSONP),tt={doAll:function(t){var n=P.$Promise||Promise,o=P.$context;return a(P),n.all(t.map(function(t){return t instanceof n?t:t&&e(t)?k(C({$context:o,$Promise:n},t)):t}),o)},ajax:k,fetchGet:B,fetchPost:G,fetchPut:X,fetchDelete:I,fetchPatch:M,fetchHead:L,fetchJsonp:F,getJSON:W,postJSON:K,putJSON:Q,deleteJSON:V,patchJSON:Y,headJSON:z,jsonp:Z};return C(P,{use:function(t){t.install(P),q.log&&console.info("["+P.$name+"] Ready. Detected "+t.$name+" v"+t.version)},setup:function(t){C(q,t)},mixin:S,AbortController:l,serialize:i,interceptors:U,version:"3.2.0",$name:"XEAjax"}),S(tt),P});